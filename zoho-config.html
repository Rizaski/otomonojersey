<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zoho Books Configuration</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .form-group {
      margin-bottom: 1rem;
    }
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }
    input, select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
    }
    button {
      background: #D32F2F;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      margin-right: 1rem;
    }
    button:hover {
      background: #B71C1C;
    }
    .info {
      background: #e3f2fd;
      padding: 1rem;
      border-radius: 4px;
      margin: 1rem 0;
    }
    .error {
      background: #ffebee;
      color: #c62828;
      padding: 1rem;
      border-radius: 4px;
      margin: 1rem 0;
    }
    .success {
      background: #e8f5e8;
      color: #2e7d32;
      padding: 1rem;
      border-radius: 4px;
      margin: 1rem 0;
    }
    code {
      background: #f5f5f5;
      padding: 0.25rem 0.5rem;
      border-radius: 3px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Zoho Books Configuration</h1>
    
    <div class="info">
      <h3>Current Application Details:</h3>
      <p><strong>Client ID:</strong> <code>1000.4W5C4WODM7XAQTY152UG1H4RQWY0AW</code></p>
      <p><strong>Current Domain:</strong> <code id="currentDomain"></code></p>
      <p><strong>Current Redirect URI:</strong> <code id="currentRedirectUri"></code></p>
    </div>

    <div class="form-group">
      <label for="redirectUri">Redirect URI for Zoho Books App:</label>
      <input type="text" id="redirectUri" placeholder="https://yourdomain.com/zoho-callback.html">
      <small>This must match exactly what you configured in your Zoho Books app settings.</small>
    </div>

    <div class="form-group">
      <label for="environment">Environment:</label>
      <select id="environment">
        <option value="auto">Auto-detect</option>
        <option value="localhost">Local Development (localhost)</option>
        <option value="netlify">Netlify</option>
        <option value="vercel">Vercel</option>
        <option value="github">GitHub Pages</option>
        <option value="custom">Custom Domain</option>
      </select>
    </div>

    <button onclick="updateRedirectUri()">Update Redirect URI</button>
    <button onclick="testConnection()">Test Connection</button>
    <button onclick="goToBilling()">Go to Billing Page</button>

    <div id="result"></div>

    <div class="info">
      <h3>How to Configure Zoho Books App:</h3>
      <ol>
        <li>Go to <a href="https://api-console.zoho.com/" target="_blank">Zoho API Console</a></li>
        <li>Find your app with Client ID: <code>1000.4W5C4WODM7XAQTY152UG1H4RQWY0AW</code></li>
        <li>Click on "Edit" or "Configure"</li>
        <li>In the "Redirect URI" field, enter: <code id="redirectUriToUse"></code></li>
        <li>Save the configuration</li>
        <li>Come back here and test the connection</li>
      </ol>
    </div>
  </div>

  <script src="js/zoho-books.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Show current domain and redirect URI
      document.getElementById('currentDomain').textContent = window.location.origin;
      document.getElementById('currentRedirectUri').textContent = window.zohoBooks.getCurrentRedirectUri();
      document.getElementById('redirectUri').value = window.zohoBooks.getCurrentRedirectUri();
      document.getElementById('redirectUriToUse').textContent = window.zohoBooks.getCurrentRedirectUri();

      // Auto-detect environment
      const hostname = window.location.hostname;
      const environment = document.getElementById('environment');
      
      if (hostname === 'localhost' || hostname === '127.0.0.1') {
        environment.value = 'localhost';
      } else if (hostname.includes('netlify.app')) {
        environment.value = 'netlify';
      } else if (hostname.includes('vercel.app')) {
        environment.value = 'vercel';
      } else if (hostname.includes('github.io')) {
        environment.value = 'github';
      } else {
        environment.value = 'custom';
      }

      // Update redirect URI based on environment
      environment.addEventListener('change', function() {
        const env = this.value;
        const input = document.getElementById('redirectUri');
        
        switch(env) {
          case 'localhost':
            input.value = 'http://localhost:3000/zoho-callback.html';
            break;
          case 'netlify':
            input.value = window.location.origin + '/zoho-callback.html';
            break;
          case 'vercel':
            input.value = window.location.origin + '/zoho-callback.html';
            break;
          case 'github':
            input.value = window.location.origin + '/zoho-callback.html';
            break;
          case 'custom':
            input.value = window.location.origin + '/zoho-callback.html';
            break;
          default:
            input.value = window.location.origin + '/zoho-callback.html';
        }
        
        document.getElementById('redirectUriToUse').textContent = input.value;
      });
    });

    function updateRedirectUri() {
      const newUri = document.getElementById('redirectUri').value;
      if (!newUri) {
        showResult('Please enter a redirect URI', 'error');
        return;
      }

      window.zohoBooks.setRedirectUri(newUri);
      showResult('Redirect URI updated successfully!', 'success');
      document.getElementById('redirectUriToUse').textContent = newUri;
    }

    function testConnection() {
      try {
        const authUrl = window.zohoBooks.getAuthUrl();
        showResult('Connection test successful! Auth URL generated.', 'success');
        console.log('Auth URL:', authUrl);
        
        // Open test window
        const testWindow = window.open(authUrl, 'zoho_test', 'width=600,height=700,scrollbars=yes,resizable=yes');
        
        // Check if window was blocked
        setTimeout(() => {
          if (!testWindow || testWindow.closed) {
            showResult('Popup was blocked. Please allow popups for this site.', 'error');
          }
        }, 1000);
        
      } catch (error) {
        showResult('Connection test failed: ' + error.message, 'error');
      }
    }

    function goToBilling() {
      window.location.href = 'billing.html';
    }

    function showResult(message, type) {
      const result = document.getElementById('result');
      result.innerHTML = `<div class="${type}">${message}</div>`;
      setTimeout(() => {
        result.innerHTML = '';
      }, 5000);
    }
  </script>
</body>
</html>

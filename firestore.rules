rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Allow authenticated users to read/write all collections
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
    
    // Allow unauthenticated access to specific order documents for client portal
    match /orders/{orderId} {
      allow read: if true; // Allow anyone to read order details
      allow write: if request.auth != null; // Only authenticated users can write
    }
    
    match /orderDetails/{orderId} {
      allow read: if true; // Allow anyone to read order details
      allow write: if request.auth != null; // Only authenticated users can write
    }
    
    // Allow unauthenticated users to submit order details (for client form)
    match /orders/{orderId} {
      allow read: if true;
      allow write: if true; // Allow client submissions without auth
    }
    
    match /orderDetails/{orderId} {
      allow read: if true;
      allow write: if true; // Allow client submissions without auth
    }
    
    // Allow notifications to be read by authenticated users only
    match /notifications/{notificationId} {
      allow read, write: if request.auth != null;
    }
    
    // Allow settings to be read/written by authenticated users only
    match /settings/{settingId} {
      allow read, write: if request.auth != null;
    }
    
    // Allow invoices to be read/written by authenticated users only
    match /invoices/{invoiceId} {
      allow read, write: if request.auth != null;
    }
    
    // Allow unauthenticated access to invoices for real-time updates
    match /invoices/{invoiceId} {
      allow read: if true; // Allow anyone to read invoices for real-time updates
      allow write: if request.auth != null; // Only authenticated users can write
    }
  }
}
